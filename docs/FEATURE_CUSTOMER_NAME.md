# ğŸ‘¤ ãŠå®¢æ§˜åç™»éŒ²æ©Ÿèƒ½ï¼ˆTier 2é™å®šï¼‰

## ğŸ¯ ã‚³ãƒ³ã‚»ãƒ—ãƒˆ

**ã€Œã—ã‚Œã£ã¨ã€è‡ªç„¶ã«ç¾ã‚Œã‚‹æ©Ÿèƒ½**
- ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã¨ã€å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã«ã€ŒãŠå®¢æ§˜åã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒ**è‡ªç„¶ã«è¡¨ç¤º**ã•ã‚Œã‚‹
- èª¬æ˜æ–‡ã‚„CTAã¯ä¸è¦ï¼ˆã€Œç™»éŒ²ã—ã‚ˆã†ï¼ã€ãªã©ã®ãƒ—ãƒƒã‚·ãƒ¥æ„Ÿã‚¼ãƒ­ï¼‰
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œã‚ã€ã“ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã‚ã‚‹ï¼ã€ã¨è‡ªåˆ†ã§ç™ºè¦‹ã™ã‚‹ä½“é¨“
- FPå–¶æ¥­æ‹…å½“è€…ãŒé¡§å®¢æƒ…å ±ã‚’ç®¡ç†ã—ã‚„ã™ããªã‚‹

---

## ğŸ“‹ æ©Ÿèƒ½ä»•æ§˜

### è¡¨ç¤ºæ¡ä»¶

**Tier 1ï¼ˆåŒ¿åãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰**: è¡¨ç¤ºãªã—
- ãŠå®¢æ§˜åãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯å­˜åœ¨ã—ãªã„
- é€šå¸¸ã®è¨ˆç®—æ©Ÿèƒ½ã®ã¿

**Tier 2/3ï¼ˆãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰**: è‡ªç„¶ã«è¡¨ç¤º
- å€Ÿå…¥é¡è¨ˆç®—ã€è¿”æ¸ˆé¡è¨ˆç®—ã€å¹´åè¨ˆç®—ã®ã™ã¹ã¦ã®ãƒ•ã‚©ãƒ¼ãƒ ã«è¡¨ç¤º
- æ—¢å­˜ã®å…¥åŠ›é …ç›®ã¨åŒã˜ãƒ‡ã‚¶ã‚¤ãƒ³ï¼ˆé•å’Œæ„Ÿãªãæº¶ã‘è¾¼ã‚€ï¼‰
- ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼: ã€Œä¾‹ï¼‰å±±ç”° å¤ªéƒã€
- ã‚ªãƒ—ã‚·ãƒ§ãƒ³é …ç›®ï¼ˆå…¥åŠ›ãªã—ã§ã‚‚è¨ˆç®—å¯èƒ½ï¼‰

---

## ğŸ¨ UI/UXè¨­è¨ˆ

### é…ç½®ä½ç½®

**ãƒ•ã‚©ãƒ¼ãƒ ã®ä¸€ç•ªä¸Š**ï¼ˆå€Ÿå…¥é‡‘é¡ãªã©ã®å‰ï¼‰:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å€Ÿå…¥é¡ã‹ã‚‰è¨ˆç®—                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  ğŸ‘¤ ãŠå®¢æ§˜åï¼ˆä»»æ„ï¼‰                 â”‚  â† NEW!ï¼ˆTier 2ä»¥ä¸Šã§è¡¨ç¤ºï¼‰
â”‚  [              ]                   â”‚
â”‚                                     â”‚
â”‚  ğŸ’° å€Ÿå…¥é‡‘é¡                        â”‚
â”‚  [ 5000 ] ä¸‡å††  [â–²] [â–¼]           â”‚
â”‚                                     â”‚
â”‚  ...                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ãƒ‡ã‚¶ã‚¤ãƒ³åŸå‰‡**:
- æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨åŒã˜ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆé•å’Œæ„Ÿãªã—ï¼‰
- å¿…é ˆãƒãƒ¼ã‚¯ãªã—ï¼ˆä»»æ„é …ç›®ã§ã‚ã‚‹ã“ã¨ã‚’æš—ç¤ºï¼‰
- èª¬æ˜æ–‡ãªã—ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ã«ã€ŒãŠå®¢æ§˜åã€ã¨ã ã‘è¡¨ç¤ºï¼‰
- ã‚¢ã‚¤ã‚³ãƒ³: ğŸ‘¤ï¼ˆäººç‰©ã‚¢ã‚¤ã‚³ãƒ³ã€æ§ãˆã‚ã«ï¼‰

---

## ğŸ”§ å®Ÿè£…ä»•æ§˜

### ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

#### LoanParams æ‹¡å¼µ
```typescript
// src/types/loan.ts

export interface LoanParams {
  // æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  principal: number;
  interestRate: number;
  years: number;
  months: number;
  repaymentType: 'equal-payment' | 'equal-principal';
  bonusPayment?: BonusPayment;

  // ğŸ†• è¿½åŠ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  customerName?: string; // Tier 2ä»¥ä¸Šã§ä½¿ç”¨
}

export interface ReverseLoanParams {
  // æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  monthlyPayment: number;
  interestRate: number;
  years: number;
  months: number;
  repaymentType: 'equal-payment' | 'equal-principal';
  bonusPayment?: ReverseBonusPayment;

  // ğŸ†• è¿½åŠ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  customerName?: string;
}

// ğŸ†• å¹´åè¨ˆç®—ç”¨ï¼ˆPhase 9.8ï¼‰
export interface IncomeParams {
  primaryIncome: number;
  interestRate: number;
  years: number;
  hasCoDebtor: boolean;
  coDebtorType?: 'joint-debtor' | 'guarantor';
  coDebtorIncome?: number;

  // ğŸ†• è¿½åŠ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  customerName?: string;
}
```

### å±¥æ­´ãƒ‡ãƒ¼ã‚¿æ‹¡å¼µ

#### HistoryEntry æ‹¡å¼µ
```typescript
// src/types/loan.ts

export interface HistoryEntry {
  id: string;
  timestamp: number;
  params: LoanParams | ReverseLoanParams | IncomeParams;
  result: LoanResult;
  mode: 'forward' | 'reverse' | 'income'; // income è¿½åŠ 

  // ğŸ†• ãŠå®¢æ§˜åï¼ˆTier 2ä»¥ä¸Šã®å±¥æ­´ã®ã¿ï¼‰
  customerName?: string;
}
```

### Supabase ãƒ†ãƒ¼ãƒ–ãƒ«æ‹¡å¼µ

#### calculations ãƒ†ãƒ¼ãƒ–ãƒ«
```sql
-- supabase/migrations/YYYYMMDDHHMMSS_add_customer_name.sql

ALTER TABLE calculations
ADD COLUMN customer_name TEXT;

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ ï¼ˆæ¤œç´¢ç”¨ï¼‰
CREATE INDEX idx_calculations_customer_name
ON calculations(user_id, customer_name)
WHERE customer_name IS NOT NULL;
```

---

## ğŸ¨ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…

### LoanForm.tsx ã®å¤‰æ›´

```tsx
// src/components/Input/LoanForm.tsx

import { useAuth } from '@/contexts/AuthContext';

export const LoanForm: React.FC = () => {
  const { user, userTier } = useAuth();
  const [customerName, setCustomerName] = useState('');

  // Tier 2ä»¥ä¸Šã§ã®ã¿è¡¨ç¤º
  const showCustomerName = userTier >= 2;

  return (
    <form>
      {/* ãŠå®¢æ§˜åãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆTier 2ä»¥ä¸Šã§ã®ã¿è¡¨ç¤ºï¼‰ */}
      {showCustomerName && (
        <div className="mb-4">
          <label className="flex items-center gap-2 text-sm font-medium text-gray-700 mb-2">
            <span className="text-lg">ğŸ‘¤</span>
            <span>ãŠå®¢æ§˜åï¼ˆä»»æ„ï¼‰</span>
          </label>
          <input
            type="text"
            value={customerName}
            onChange={(e) => setCustomerName(e.target.value)}
            placeholder="ä¾‹ï¼‰å±±ç”° å¤ªéƒ"
            className="w-full px-4 py-3 border border-gray-300 rounded-lg
                       focus:ring-2 focus:ring-blue-500 focus:border-transparent
                       text-lg"
            maxLength={50}
          />
        </div>
      )}

      {/* æ—¢å­˜ã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */}
      <div className="mb-4">
        <label>ğŸ’° å€Ÿå…¥é‡‘é¡</label>
        {/* ... */}
      </div>
      {/* ... */}
    </form>
  );
};
```

### ReverseLoanForm.tsx ã®å¤‰æ›´

åŒæ§˜ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§è¿½åŠ :
```tsx
{showCustomerName && (
  <div className="mb-4">
    <label className="flex items-center gap-2 text-sm font-medium text-gray-700 mb-2">
      <span className="text-lg">ğŸ‘¤</span>
      <span>ãŠå®¢æ§˜åï¼ˆä»»æ„ï¼‰</span>
    </label>
    <input
      type="text"
      value={customerName}
      onChange={(e) => setCustomerName(e.target.value)}
      placeholder="ä¾‹ï¼‰å±±ç”° å¤ªéƒ"
      className="w-full px-4 py-3 border border-gray-300 rounded-lg
                 focus:ring-2 focus:ring-blue-500 focus:border-transparent
                 text-lg"
      maxLength={50}
    />
  </div>
)}
```

### IncomeForm.tsx ã®å¤‰æ›´ï¼ˆPhase 9.8å®Ÿè£…æ™‚ï¼‰

å¹´åè¨ˆç®—ãƒ•ã‚©ãƒ¼ãƒ ã«ã‚‚åŒæ§˜ã«è¿½åŠ ã€‚

---

## ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ä¿å­˜

### localStorageï¼ˆTier 1ï¼‰

Tier 1 ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯ customerName ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯è¡¨ç¤ºã•ã‚Œãªã„ãŸã‚ã€localStorage ã«ã¯ä¿å­˜ã•ã‚Œãªã„ã€‚

### Supabaseï¼ˆTier 2/3ï¼‰

```typescript
// src/contexts/LoanContext.tsx ã¾ãŸã¯ useCalculator.ts

const saveCalculation = async (params: LoanParams, result: LoanResult) => {
  if (userTier >= 2 && user) {
    // Supabase ã«ä¿å­˜
    const { error } = await supabase
      .from('calculations')
      .insert({
        user_id: user.id,
        calculation_type: 'loan_forward',
        params: params,
        result: result,
        customer_name: params.customerName || null, // ğŸ†•
        created_at: new Date().toISOString()
      });

    if (error) {
      console.error('Failed to save calculation:', error);
    }
  } else {
    // localStorage ã«ä¿å­˜ï¼ˆTier 1ï¼‰
    // customerName ã¯å«ã¾ã‚Œãªã„
  }
};
```

---

## ğŸ“Š å±¥æ­´è¡¨ç¤ºã§ã®æ´»ç”¨

### HistoryList.tsx ã®å¤‰æ›´

```tsx
// src/components/History/HistoryList.tsx

export const HistoryList: React.FC = () => {
  const { userTier } = useAuth();

  return (
    <div className="space-y-4">
      {history.map((entry) => (
        <div key={entry.id} className="bg-white p-4 rounded-lg shadow">
          {/* ãŠå®¢æ§˜åè¡¨ç¤ºï¼ˆTier 2ä»¥ä¸Š & å…¥åŠ›ã•ã‚Œã¦ã„ã‚‹å ´åˆã®ã¿ï¼‰ */}
          {userTier >= 2 && entry.customerName && (
            <div className="mb-2 flex items-center gap-2 text-sm text-gray-600">
              <span className="text-base">ğŸ‘¤</span>
              <span className="font-medium">{entry.customerName}</span>
            </div>
          )}

          {/* æ—¢å­˜ã®å±¥æ­´è¡¨ç¤º */}
          <div className="text-lg font-bold">
            {formatCurrency(entry.result.totalPayment)}
          </div>
          <div className="text-sm text-gray-600">
            {new Date(entry.timestamp).toLocaleDateString('ja-JP')}
          </div>
          {/* ... */}
        </div>
      ))}
    </div>
  );
};
```

---

## ğŸ” æ¤œç´¢æ©Ÿèƒ½ï¼ˆå°†æ¥æ‹¡å¼µï¼‰

### ãŠå®¢æ§˜åã§ã®å±¥æ­´æ¤œç´¢ï¼ˆTier 2/3ï¼‰

```tsx
// å°†æ¥çš„ã«å®Ÿè£…ï¼ˆPhase 19ä»¥é™ï¼‰
const [searchQuery, setSearchQuery] = useState('');

const filteredHistory = history.filter(entry =>
  entry.customerName?.includes(searchQuery)
);
```

---

## ğŸ¯ æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“
- âœ… è‡ªç„¶ãªç™ºè¦‹ä½“é¨“ï¼ˆã€Œã‚ã€ã“ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã‚ã‚‹ï¼ã€ï¼‰
- âœ… ãƒ—ãƒƒã‚·ãƒ¥æ„Ÿã‚¼ãƒ­ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã§ä½¿ãˆã‚‹ï¼‰
- âœ… FPå–¶æ¥­æ‹…å½“è€…ã®æ¥­å‹™åŠ¹ç‡åŒ–ï¼ˆé¡§å®¢æƒ…å ±ç®¡ç†ï¼‰

### ãƒ“ã‚¸ãƒã‚¹
- âœ… Tier 2 ã®ä¾¡å€¤å‘ä¸Šï¼ˆç„¡æ–™ã§ã‚‚ä¾¿åˆ©ãªæ©Ÿèƒ½ï¼‰
- âœ… é¡§å®¢ç®¡ç†ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ã®å´é¢ã‚’å¼·åŒ–
- âœ… æœ‰æ–™ç‰ˆã¸ã®å°ç·šï¼ˆã‚ˆã‚Šé«˜åº¦ãªé¡§å®¢ç®¡ç†æ©Ÿèƒ½ã¸ï¼‰

### æŠ€è¡“
- âœ… æ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’æ‹¡å¼µï¼ˆå¤§ããªå¤‰æ›´ãªã—ï¼‰
- âœ… Tier ã«ã‚ˆã‚‹è¡¨ç¤ºåˆ¶å¾¡ï¼ˆuserTier >= 2 ã®æ¡ä»¶åˆ†å²ã®ã¿ï¼‰
- âœ… æ¤œç´¢æ©Ÿèƒ½ã®åŸºç›¤ï¼ˆå°†æ¥ã®æ‹¡å¼µãŒå®¹æ˜“ï¼‰

---

## ğŸ“ å®Ÿè£…ãƒã‚±ãƒƒãƒˆ

### TICKET-990: ãŠå®¢æ§˜åãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ ï¼ˆTier 2é™å®šï¼‰

**Priority**: ğŸŸ¡ High
**Estimate**: 1æ™‚é–“
**Dependencies**: ãªã—ï¼ˆPhase 9.8 ã¨ä¸¦è¡Œå¯èƒ½ï¼‰

**Tasks**:
- [ ] `src/types/loan.ts` ã« `customerName?: string` è¿½åŠ 
- [ ] `LoanForm.tsx` ã«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ ï¼ˆTier 2ä»¥ä¸Šã§è¡¨ç¤ºï¼‰
- [ ] `ReverseLoanForm.tsx` ã«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 
- [ ] `IncomeForm.tsx` ã«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ ï¼ˆPhase 9.8å®Ÿè£…æ™‚ï¼‰
- [ ] Supabase migration ä½œæˆï¼ˆcustomer_name ã‚«ãƒ©ãƒ è¿½åŠ ï¼‰
- [ ] `LoanContext.tsx` ã§ä¿å­˜å‡¦ç†å®Ÿè£…
- [ ] `HistoryList.tsx` ã§è¡¨ç¤ºå‡¦ç†å®Ÿè£…
- [ ] æ‰‹å‹•ãƒ†ã‚¹ãƒˆï¼ˆTier 1/2/3 ã§è¡¨ç¤ºåˆ‡æ›¿ç¢ºèªï¼‰

**Acceptance Criteria**:
- Tier 1: ãŠå®¢æ§˜åãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯è¡¨ç¤ºã•ã‚Œãªã„
- Tier 2/3: ãŠå®¢æ§˜åãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒè‡ªç„¶ã«è¡¨ç¤ºã•ã‚Œã‚‹
- å…¥åŠ›ã—ãŸãŠå®¢æ§˜åãŒå±¥æ­´ã«ä¿å­˜ã•ã‚Œã‚‹
- å±¥æ­´ä¸€è¦§ã§ãŠå®¢æ§˜åãŒè¡¨ç¤ºã•ã‚Œã‚‹

---

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- `docs/TICKETS_INCOME_CALCULATOR.md`: Phase 9.8 ãƒã‚±ãƒƒãƒˆ
- `docs/PHASE-18-SUMMARY.md`: Freemiumæˆ¦ç•¥
- `src/types/loan.ts`: å‹å®šç¾©
- `src/contexts/AuthContext.tsx`: Tier åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯

---

**ä½œæˆæ—¥**: 2025-10-27
**Phase**: 9.9ï¼ˆç„¡æ–™ç‰ˆæ©Ÿèƒ½æ‹¡å¼µ - Tier 2 ä¾¡å€¤å‘ä¸Šï¼‰
**Total Estimate**: 1æ™‚é–“
