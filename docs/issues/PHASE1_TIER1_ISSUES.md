# Phase 1 (Tier 1): åŸºæœ¬FPæ©Ÿèƒ½ - Issue List

**ç›®æ¨™**: ç„¡æ–™ç‰ˆã‹ã‚‰ã€Œãƒ©ã‚¤ãƒˆæœ‰æ–™ç‰ˆï¼ˆÂ¥980/æœˆï¼‰ã€ã¸ã®ç§»è¡Œ
**æœŸé–“**: 3ãƒ¶æœˆ
**å„ªå…ˆåº¦**: Phase 0å®Œäº†å¾Œã™ãã«ç€æ‰‹

---

## ğŸ“Š æ¦‚è¦

### é”æˆç›®æ¨™

- âœ… ãƒ©ã‚¤ãƒ•ãƒ—ãƒ©ãƒ³ç®¡ç†æ©Ÿèƒ½ã®å®Ÿè£…
- âœ… æœˆæ¬¡ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ãƒ­ãƒ¼è¡¨ã®å¯è¦–åŒ–
- âœ… æ•™è‚²è²»ãƒ»è€å¾Œè³‡é‡‘ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- âœ… PDFãƒ¬ãƒãƒ¼ãƒˆè‡ªå‹•ç”Ÿæˆ
- âœ… æœ‰æ–™ä¼šå“¡æ©Ÿèƒ½ï¼ˆStripeæ±ºæ¸ˆï¼‰
- âœ… Supabaseã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–

### KPI

| æŒ‡æ¨™ | ç›®æ¨™å€¤ |
|------|--------|
| ç„¡æ–™ç‰ˆç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼ | 500å |
| æœ‰æ–™ç‰ˆè»¢æ›ç‡ | 10% |
| æœ‰æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•° | 50å |
| æœˆæ¬¡åç›Šï¼ˆMRRï¼‰ | Â¥49,000 |

### å…¨ä½“å·¥æ•°

| åˆè¨ˆæœŸé–“ | ç´„3ãƒ¶æœˆï¼ˆ12é€±é–“ï¼‰ |
|---------|-----------------|
| ç·Issueæ•° | 7ä»¶ |

---

## ğŸ« Issueä¸€è¦§

| Issue | ã‚¿ã‚¤ãƒˆãƒ« | å„ªå…ˆåº¦ | æœŸé–“ | ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ | ä¾å­˜ |
|-------|---------|--------|------|----------------|------|
| ISSUE-101 | Supabaseã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— | ğŸ”´ Critical | 2é€±é–“ | âŒ | ãªã— |
| ISSUE-102 | ãƒ©ã‚¤ãƒ•ã‚¤ãƒ™ãƒ³ãƒˆå…¥åŠ› | ğŸŸ¡ High | 3é€±é–“ | âœ… | 101 |
| ISSUE-103 | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ãƒ­ãƒ¼è¡¨ | ğŸŸ¡ High | 4é€±é–“ | âœ… | 101, 102 |
| ISSUE-104 | æ•™è‚²è²»è¨ˆç®— | ğŸŸ¡ High | 3é€±é–“ | âœ… | 102 |
| ISSUE-105 | è€å¾Œè³‡é‡‘ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | ğŸŸ¡ High | 3é€±é–“ | âœ… | 102 |
| ISSUE-106 | PDFãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ | ğŸŸ¢ Medium | 2é€±é–“ | âœ… | 103, 104, 105 |
| ISSUE-107 | Stripeæ±ºæ¸ˆçµ±åˆ | ğŸŸ¡ High | 2é€±é–“ | âŒ | 101 |

### ä¸¦åˆ—å®Ÿè¡Œæˆ¦ç•¥

```
Week 1-2:  ISSUE-101 (Supabase)
Week 3-5:  ISSUE-102 (ãƒ©ã‚¤ãƒ•ã‚¤ãƒ™ãƒ³ãƒˆ) || ISSUE-107 (Stripe)
Week 6-9:  ISSUE-103 (CFè¡¨) || ISSUE-104 (æ•™è‚²è²») || ISSUE-105 (è€å¾Œ)
Week 10-11: ISSUE-106 (PDF)
Week 12:   çµ±åˆãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒãƒƒã‚°
```

---

## ISSUE-101: Supabaseã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— ğŸ”´ Critical

### ğŸ“‹ æ¦‚è¦

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ã—ã¦Supabaseã‚’å°å…¥ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

**èƒŒæ™¯**:
- Phase 0ã§ã¯ localStorage ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã—ãŸãŒã€æœ‰æ–™ç‰ˆã§ã¯è¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹åŒæœŸãƒ»ãƒ‡ãƒ¼ã‚¿ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒå¿…è¦
- ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼æ©Ÿèƒ½ãŒå¿…è¦ï¼ˆãƒ¡ãƒ¼ãƒ«ãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€å°†æ¥çš„ã«ã¯Google OAuthï¼‰

### ğŸ¯ ã‚¿ã‚¹ã‚¯è©³ç´°

#### 1. Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

```bash
# Supabase CLI ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install -g supabase

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–
supabase init

# ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒèµ·å‹•
supabase start
```

#### 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

```sql
-- users ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆSupabase Authé€£æºï¼‰
CREATE TABLE users (
  id UUID PRIMARY KEY REFERENCES auth.users(id),
  email TEXT UNIQUE NOT NULL,
  full_name TEXT,
  plan_tier TEXT DEFAULT 'free' CHECK (plan_tier IN ('free', 'lite', 'pro', 'enterprise')),
  stripe_customer_id TEXT,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- life_plans ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE life_plans (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  name TEXT NOT NULL,
  client_name TEXT,
  current_age INTEGER NOT NULL,
  retirement_age INTEGER DEFAULT 65,
  life_expectancy INTEGER DEFAULT 100,
  data JSONB NOT NULL,  -- ãƒ©ã‚¤ãƒ•ãƒ—ãƒ©ãƒ³å…¨ãƒ‡ãƒ¼ã‚¿
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- life_events ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE life_events (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  life_plan_id UUID REFERENCES life_plans(id) ON DELETE CASCADE,
  event_type TEXT NOT NULL,  -- 'marriage', 'birth', 'education', 'car', 'relocation', 'retirement'
  event_name TEXT NOT NULL,
  event_year INTEGER NOT NULL,
  event_month INTEGER DEFAULT 1,
  amount NUMERIC(12, 2) NOT NULL,
  recurring BOOLEAN DEFAULT FALSE,
  recurring_years INTEGER,
  notes TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);

-- cash_flow_snapshots ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæœˆæ¬¡CFè¨ˆç®—çµæœã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
CREATE TABLE cash_flow_snapshots (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  life_plan_id UUID REFERENCES life_plans(id) ON DELETE CASCADE,
  year INTEGER NOT NULL,
  month INTEGER NOT NULL,
  income NUMERIC(12, 2) NOT NULL,
  expenses NUMERIC(12, 2) NOT NULL,
  savings NUMERIC(12, 2) NOT NULL,
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(life_plan_id, year, month)
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ
CREATE INDEX idx_life_plans_user_id ON life_plans(user_id);
CREATE INDEX idx_life_events_plan_id ON life_events(life_plan_id);
CREATE INDEX idx_cash_flow_plan_id ON cash_flow_snapshots(life_plan_id);
```

#### 3. Row Level Security (RLS) è¨­å®š

```sql
-- users ãƒ†ãƒ¼ãƒ–ãƒ«
ALTER TABLE users ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own data"
  ON users FOR SELECT
  USING (auth.uid() = id);

CREATE POLICY "Users can update own data"
  ON users FOR UPDATE
  USING (auth.uid() = id);

-- life_plans ãƒ†ãƒ¼ãƒ–ãƒ«
ALTER TABLE life_plans ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own plans"
  ON life_plans FOR SELECT
  USING (auth.uid() = user_id);

CREATE POLICY "Users can create own plans"
  ON life_plans FOR INSERT
  WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can update own plans"
  ON life_plans FOR UPDATE
  USING (auth.uid() = user_id);

CREATE POLICY "Users can delete own plans"
  ON life_plans FOR DELETE
  USING (auth.uid() = user_id);

-- life_events ãƒ†ãƒ¼ãƒ–ãƒ«
ALTER TABLE life_events ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own events"
  ON life_events FOR SELECT
  USING (
    EXISTS (
      SELECT 1 FROM life_plans
      WHERE life_plans.id = life_events.life_plan_id
      AND life_plans.user_id = auth.uid()
    )
  );

-- ä»–ã®CRUDæ“ä½œã‚‚åŒæ§˜ã«è¨­å®š
```

#### 4. Reactçµ±åˆ

```bash
# ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install @supabase/supabase-js
```

```typescript
// src/lib/supabase.ts
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL || '';
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY || '';

export const supabase = createClient(supabaseUrl, supabaseAnonKey);

// å‹å®šç¾©
export interface Database {
  public: {
    Tables: {
      users: {
        Row: {
          id: string;
          email: string;
          full_name: string | null;
          plan_tier: 'free' | 'lite' | 'pro' | 'enterprise';
          stripe_customer_id: string | null;
          created_at: string;
          updated_at: string;
        };
        Insert: Omit<Database['public']['Tables']['users']['Row'], 'id' | 'created_at' | 'updated_at'>;
        Update: Partial<Database['public']['Tables']['users']['Insert']>;
      };
      life_plans: {
        Row: {
          id: string;
          user_id: string;
          name: string;
          client_name: string | null;
          current_age: number;
          retirement_age: number;
          life_expectancy: number;
          data: any;
          created_at: string;
          updated_at: string;
        };
        Insert: Omit<Database['public']['Tables']['life_plans']['Row'], 'id' | 'created_at' | 'updated_at'>;
        Update: Partial<Database['public']['Tables']['life_plans']['Insert']>;
      };
      // ... ä»–ã®ãƒ†ãƒ¼ãƒ–ãƒ«å‹å®šç¾©
    };
  };
}
```

#### 5. èªè¨¼ãƒ•ãƒ­ãƒ¼å®Ÿè£…

```typescript
// src/contexts/AuthContext.tsx
import { createContext, useContext, useEffect, useState, ReactNode } from 'react';
import { User, Session } from '@supabase/supabase-js';
import { supabase } from '@/lib/supabase';

interface AuthContextType {
  user: User | null;
  session: Session | null;
  signIn: (email: string, password: string) => Promise<void>;
  signUp: (email: string, password: string, fullName: string) => Promise<void>;
  signOut: () => Promise<void>;
  loading: boolean;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export function AuthProvider({ children }: { children: ReactNode }) {
  const [user, setUser] = useState<User | null>(null);
  const [session, setSession] = useState<Session | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    // ã‚»ãƒƒã‚·ãƒ§ãƒ³å–å¾—
    supabase.auth.getSession().then(({ data: { session } }) => {
      setSession(session);
      setUser(session?.user ?? null);
      setLoading(false);
    });

    // èªè¨¼çŠ¶æ…‹å¤‰æ›´ç›£è¦–
    const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {
      setSession(session);
      setUser(session?.user ?? null);
    });

    return () => subscription.unsubscribe();
  }, []);

  const signIn = async (email: string, password: string) => {
    const { error } = await supabase.auth.signInWithPassword({ email, password });
    if (error) throw error;
  };

  const signUp = async (email: string, password: string, fullName: string) => {
    const { data, error } = await supabase.auth.signUp({
      email,
      password,
      options: {
        data: {
          full_name: fullName,
        },
      },
    });
    if (error) throw error;

    // users ãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆ
    if (data.user) {
      await supabase.from('users').insert({
        id: data.user.id,
        email: data.user.email!,
        full_name: fullName,
        plan_tier: 'free',
      });
    }
  };

  const signOut = async () => {
    const { error } = await supabase.auth.signOut();
    if (error) throw error;
  };

  return (
    <AuthContext.Provider value={{ user, session, signIn, signUp, signOut, loading }}>
      {children}
    </AuthContext.Provider>
  );
}

export function useAuth() {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth must be used within AuthProvider');
  }
  return context;
}
```

### âœ… å®Œäº†æ¡ä»¶

- [ ] Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆå®Œäº†
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆãƒ»ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
- [ ] RLSè¨­å®šå®Œäº†
- [ ] Reactçµ±åˆï¼ˆsupabase-jsã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰
- [ ] AuthContextå®Ÿè£…ãƒ»ãƒ†ã‚¹ãƒˆ
- [ ] ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ãƒšãƒ¼ã‚¸å®Ÿè£…
- [ ] `.env.example` ã« Supabaseç’°å¢ƒå¤‰æ•°è¿½åŠ 
- [ ] ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§Supabaseå‹•ä½œç¢ºèª

### ğŸ”§ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- Supabaseï¼ˆBackend as a Serviceï¼‰
- PostgreSQLï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼‰
- Supabase Authï¼ˆèªè¨¼ï¼‰
- Row Level Securityï¼ˆã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼‰

### ğŸ“ æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«

```
src/
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ supabase.ts              # Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”œâ”€â”€ contexts/
â”‚   â””â”€â”€ AuthContext.tsx          # èªè¨¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ Login.tsx                # ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ Signup.tsx               # ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ãƒšãƒ¼ã‚¸
â”‚   â””â”€â”€ Dashboard.tsx            # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆãƒ­ã‚°ã‚¤ãƒ³å¾Œï¼‰
â””â”€â”€ types/
    â””â”€â”€ database.ts              # Supabaseå‹å®šç¾©

supabase/
â”œâ”€â”€ migrations/
â”‚   â””â”€â”€ 20251014_initial_schema.sql
â””â”€â”€ config.toml
```

### ğŸš« ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå§”ä»»: ä¸å¯

**ç†ç”±**: ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æ ¹å¹¹éƒ¨åˆ†ã§ã‚ã‚Šã€å…¨ä½“è¨­è¨ˆã®ç†è§£ãŒå¿…è¦

---

## ISSUE-102: ãƒ©ã‚¤ãƒ•ã‚¤ãƒ™ãƒ³ãƒˆå…¥åŠ›UI ğŸŸ¡ High

### ğŸ“‹ æ¦‚è¦

çµå©šãƒ»å‡ºç”£ãƒ»å­ä¾›ã®é€²å­¦ãƒ»è»Šè³¼å…¥ãƒ»ä½ã¿æ›¿ãˆãƒ»é€€è·ãªã©ã®ãƒ©ã‚¤ãƒ•ã‚¤ãƒ™ãƒ³ãƒˆã‚’å…¥åŠ›ã™ã‚‹UIã‚’å®Ÿè£…ã—ã¾ã™ã€‚

### ğŸ¯ ã‚¿ã‚¹ã‚¯è©³ç´°

#### 1. ãƒ©ã‚¤ãƒ•ã‚¤ãƒ™ãƒ³ãƒˆå‹å®šç¾©

```typescript
// src/types/lifeEvent.ts
export type LifeEventType =
  | 'marriage'
  | 'birth'
  | 'education_elementary'
  | 'education_junior_high'
  | 'education_high_school'
  | 'education_university'
  | 'car_purchase'
  | 'relocation'
  | 'retirement';

export interface LifeEvent {
  id: string;
  eventType: LifeEventType;
  eventName: string;
  eventYear: number;
  eventMonth: number;
  amount: number;
  recurring: boolean;
  recurringYears?: number;
  notes?: string;
  createdAt: string;
}

export interface LifeEventTemplate {
  eventType: LifeEventType;
  defaultName: string;
  defaultAmount: number;
  description: string;
  icon: string;
}

export const LIFE_EVENT_TEMPLATES: LifeEventTemplate[] = [
  {
    eventType: 'marriage',
    defaultName: 'çµå©š',
    defaultAmount: 3000000,
    description: 'çµå©šå¼ãƒ»æ–°ç”Ÿæ´»è²»ç”¨',
    icon: 'ğŸ’’',
  },
  {
    eventType: 'birth',
    defaultName: 'å‡ºç”£',
    defaultAmount: 500000,
    description: 'å‡ºç”£è²»ç”¨ãƒ»ãƒ™ãƒ“ãƒ¼ç”¨å“',
    icon: 'ğŸ‘¶',
  },
  {
    eventType: 'education_elementary',
    defaultName: 'å°å­¦æ ¡å…¥å­¦',
    defaultAmount: 200000,
    description: 'å…¥å­¦æº–å‚™è²»ç”¨',
    icon: 'ğŸ’',
  },
  // ... ä»–ã®ã‚¤ãƒ™ãƒ³ãƒˆ
];
```

#### 2. ãƒ©ã‚¤ãƒ•ã‚¤ãƒ™ãƒ³ãƒˆå…¥åŠ›ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```typescript
// src/components/LifeEvent/LifeEventForm.tsx
import { useState } from 'react';
import { LifeEvent, LifeEventType, LIFE_EVENT_TEMPLATES } from '@/types/lifeEvent';
import { supabase } from '@/lib/supabase';
import { useAuth } from '@/contexts/AuthContext';
import { useToast } from '@/hooks/useToast';

interface LifeEventFormProps {
  lifePlanId: string;
  onEventAdded: (event: LifeEvent) => void;
  onClose: () => void;
}

export function LifeEventForm({ lifePlanId, onEventAdded, onClose }: LifeEventFormProps) {
  const { user } = useAuth();
  const { showToast } = useToast();
  const [eventType, setEventType] = useState<LifeEventType>('marriage');
  const [eventName, setEventName] = useState('');
  const [eventYear, setEventYear] = useState(new Date().getFullYear());
  const [eventMonth, setEventMonth] = useState(1);
  const [amount, setAmount] = useState(0);
  const [recurring, setRecurring] = useState(false);
  const [recurringYears, setRecurringYears] = useState(1);
  const [notes, setNotes] = useState('');
  const [submitting, setSubmitting] = useState(false);

  const selectedTemplate = LIFE_EVENT_TEMPLATES.find((t) => t.eventType === eventType);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!user) return;

    setSubmitting(true);
    try {
      const { data, error } = await supabase
        .from('life_events')
        .insert({
          life_plan_id: lifePlanId,
          event_type: eventType,
          event_name: eventName || selectedTemplate?.defaultName || '',
          event_year: eventYear,
          event_month: eventMonth,
          amount: amount * 10000, // ä¸‡å†† â†’ å††
          recurring,
          recurring_years: recurring ? recurringYears : null,
          notes,
        })
        .select()
        .single();

      if (error) throw error;

      showToast('ãƒ©ã‚¤ãƒ•ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ ã—ã¾ã—ãŸ', 'success');
      onEventAdded(data);
      onClose();
    } catch (error) {
      console.error('Error adding life event:', error);
      showToast('ãƒ©ã‚¤ãƒ•ã‚¤ãƒ™ãƒ³ãƒˆã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
    } finally {
      setSubmitting(false);
    }
  };

  return (
    <form onSubmit={handleSubmit} className="space-y-4">
      <h2 className="text-xl font-bold">ãƒ©ã‚¤ãƒ•ã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ </h2>

      {/* ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—é¸æŠ */}
      <div className="grid grid-cols-3 gap-2">
        {LIFE_EVENT_TEMPLATES.map((template) => (
          <button
            key={template.eventType}
            type="button"
            onClick={() => {
              setEventType(template.eventType);
              setEventName(template.defaultName);
              setAmount(template.defaultAmount / 10000);
            }}
            className={`p-4 rounded-lg border-2 ${
              eventType === template.eventType
                ? 'border-blue-500 bg-blue-50'
                : 'border-gray-300 hover:border-gray-400'
            }`}
          >
            <div className="text-3xl mb-2">{template.icon}</div>
            <div className="text-sm font-semibold">{template.defaultName}</div>
          </button>
        ))}
      </div>

      {/* ã‚¤ãƒ™ãƒ³ãƒˆå */}
      <div>
        <label className="block text-sm font-medium mb-1">ã‚¤ãƒ™ãƒ³ãƒˆå</label>
        <input
          type="text"
          value={eventName}
          onChange={(e) => setEventName(e.target.value)}
          placeholder={selectedTemplate?.defaultName}
          className="w-full px-3 py-2 border rounded-lg"
        />
      </div>

      {/* ç™ºç”Ÿå¹´æœˆ */}
      <div className="grid grid-cols-2 gap-4">
        <div>
          <label className="block text-sm font-medium mb-1">ç™ºç”Ÿå¹´</label>
          <input
            type="number"
            value={eventYear}
            onChange={(e) => setEventYear(Number(e.target.value))}
            min={new Date().getFullYear()}
            max={2100}
            className="w-full px-3 py-2 border rounded-lg"
          />
        </div>
        <div>
          <label className="block text-sm font-medium mb-1">ç™ºç”Ÿæœˆ</label>
          <select
            value={eventMonth}
            onChange={(e) => setEventMonth(Number(e.target.value))}
            className="w-full px-3 py-2 border rounded-lg"
          >
            {Array.from({ length: 12 }, (_, i) => i + 1).map((month) => (
              <option key={month} value={month}>
                {month}æœˆ
              </option>
            ))}
          </select>
        </div>
      </div>

      {/* é‡‘é¡ */}
      <div>
        <label className="block text-sm font-medium mb-1">é‡‘é¡ï¼ˆä¸‡å††ï¼‰</label>
        <input
          type="number"
          value={amount}
          onChange={(e) => setAmount(Number(e.target.value))}
          min={0}
          step={10}
          className="w-full px-3 py-2 border rounded-lg"
        />
        <p className="text-xs text-gray-500 mt-1">
          æ¨å¥¨é‡‘é¡: {(selectedTemplate?.defaultAmount || 0) / 10000}ä¸‡å††
        </p>
      </div>

      {/* ç¶™ç¶šè²»ç”¨ */}
      <div>
        <label className="flex items-center">
          <input
            type="checkbox"
            checked={recurring}
            onChange={(e) => setRecurring(e.target.checked)}
            className="mr-2"
          />
          <span className="text-sm">ç¶™ç¶šè²»ç”¨ï¼ˆè¤‡æ•°å¹´ï¼‰</span>
        </label>
        {recurring && (
          <input
            type="number"
            value={recurringYears}
            onChange={(e) => setRecurringYears(Number(e.target.value))}
            min={1}
            max={50}
            className="mt-2 w-full px-3 py-2 border rounded-lg"
            placeholder="ç¶™ç¶šå¹´æ•°"
          />
        )}
      </div>

      {/* ãƒ¡ãƒ¢ */}
      <div>
        <label className="block text-sm font-medium mb-1">ãƒ¡ãƒ¢</label>
        <textarea
          value={notes}
          onChange={(e) => setNotes(e.target.value)}
          rows={3}
          className="w-full px-3 py-2 border rounded-lg"
          placeholder="è£œè¶³æƒ…å ±ãŒã‚ã‚Œã°è¨˜å…¥ã—ã¦ãã ã•ã„"
        />
      </div>

      {/* ãƒœã‚¿ãƒ³ */}
      <div className="flex gap-2">
        <button
          type="submit"
          disabled={submitting}
          className="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50"
        >
          {submitting ? 'è¿½åŠ ä¸­...' : 'è¿½åŠ '}
        </button>
        <button
          type="button"
          onClick={onClose}
          className="flex-1 bg-gray-200 text-gray-800 py-2 rounded-lg hover:bg-gray-300"
        >
          ã‚­ãƒ£ãƒ³ã‚»ãƒ«
        </button>
      </div>
    </form>
  );
}
```

#### 3. ãƒ©ã‚¤ãƒ•ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```typescript
// src/components/LifeEvent/LifeEventList.tsx
import { useEffect, useState } from 'react';
import { LifeEvent } from '@/types/lifeEvent';
import { supabase } from '@/lib/supabase';
import { useAuth } from '@/contexts/AuthContext';

interface LifeEventListProps {
  lifePlanId: string;
}

export function LifeEventList({ lifePlanId }: LifeEventListProps) {
  const { user } = useAuth();
  const [events, setEvents] = useState<LifeEvent[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    if (!user) return;

    const fetchEvents = async () => {
      const { data, error } = await supabase
        .from('life_events')
        .select('*')
        .eq('life_plan_id', lifePlanId)
        .order('event_year', { ascending: true })
        .order('event_month', { ascending: true });

      if (error) {
        console.error('Error fetching life events:', error);
      } else {
        setEvents(data || []);
      }
      setLoading(false);
    };

    fetchEvents();
  }, [user, lifePlanId]);

  if (loading) return <div>èª­ã¿è¾¼ã¿ä¸­...</div>;

  return (
    <div className="space-y-4">
      <h2 className="text-xl font-bold">ãƒ©ã‚¤ãƒ•ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§</h2>
      {events.length === 0 ? (
        <p className="text-gray-500">ã¾ã ãƒ©ã‚¤ãƒ•ã‚¤ãƒ™ãƒ³ãƒˆãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
      ) : (
        <div className="space-y-2">
          {events.map((event) => (
            <div key={event.id} className="p-4 border rounded-lg">
              <div className="flex justify-between items-start">
                <div>
                  <h3 className="font-semibold">{event.event_name}</h3>
                  <p className="text-sm text-gray-600">
                    {event.event_year}å¹´{event.event_month}æœˆ
                  </p>
                  <p className="text-lg font-bold text-blue-600">
                    {(event.amount / 10000).toLocaleString()}ä¸‡å††
                  </p>
                  {event.recurring && (
                    <p className="text-xs text-orange-600">
                      {event.recurring_years}å¹´é–“ç¶™ç¶š
                    </p>
                  )}
                </div>
                <button className="text-red-500 hover:text-red-700">å‰Šé™¤</button>
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );
}
```

### âœ… å®Œäº†æ¡ä»¶

- [ ] LifeEventå‹å®šç¾©å®Œäº†
- [ ] ã‚¤ãƒ™ãƒ³ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆï¼ˆ10ç¨®é¡ä»¥ä¸Šï¼‰
- [ ] LifeEventFormã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…
- [ ] LifeEventListã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…
- [ ] Supabaseé€£æºï¼ˆCRUDæ“ä½œï¼‰
- [ ] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…
- [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ
- [ ] ãƒ†ã‚¹ãƒˆä½œæˆï¼ˆãƒ¦ãƒ‹ãƒƒãƒˆãƒ»çµ±åˆï¼‰

### ğŸ”§ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- React Hook Formï¼ˆãƒ•ã‚©ãƒ¼ãƒ ç®¡ç†ï¼‰
- Zodï¼ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
- Supabaseï¼ˆãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ï¼‰

### ğŸ“ æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«

```
src/
â”œâ”€â”€ components/
â”‚   â””â”€â”€ LifeEvent/
â”‚       â”œâ”€â”€ LifeEventForm.tsx
â”‚       â”œâ”€â”€ LifeEventList.tsx
â”‚       â””â”€â”€ LifeEventCard.tsx
â””â”€â”€ types/
    â””â”€â”€ lifeEvent.ts
```

### âœ… ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå§”ä»»: å¯èƒ½

**ç†ç”±**: ç‹¬ç«‹ã—ãŸUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã‚ã‚Šã€æ˜ç¢ºãªä»•æ§˜ãŒã‚ã‚‹

---

## ISSUE-103: æœˆæ¬¡ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ãƒ­ãƒ¼è¡¨ ğŸŸ¡ High

### ğŸ“‹ æ¦‚è¦

ç¾åœ¨ã€œè€å¾Œï¼ˆ100æ­³ã¾ã§ï¼‰ã®æœˆæ¬¡åæ”¯ã‚’ã‚°ãƒ©ãƒ•ã§å¯è¦–åŒ–ã—ã¾ã™ã€‚åå…¥ãƒ»æ”¯å‡ºãƒ»è²¯è“„æ®‹é«˜ã®æ¨ç§»ã‚’è¡¨ç¤ºã—ã€è³‡é‡‘ã‚·ãƒ§ãƒ¼ãƒˆã®æ™‚æœŸã‚’è‡ªå‹•æ¤œå‡ºã—ã¾ã™ã€‚

### ğŸ¯ ã‚¿ã‚¹ã‚¯è©³ç´°

#### 1. CFè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯

```typescript
// src/utils/cashFlowCalculator.ts
import { LifeEvent } from '@/types/lifeEvent';

export interface CashFlowInput {
  currentAge: number;
  retirementAge: number;
  lifeExpectancy: number;
  annualIncome: number;
  monthlyExpenses: number;
  currentSavings: number;
  lifeEvents: LifeEvent[];
  loanPayment?: number; // ä½å®…ãƒ­ãƒ¼ãƒ³æœˆæ¬¡è¿”æ¸ˆé¡
  loanEndYear?: number; // ãƒ­ãƒ¼ãƒ³å®Œæ¸ˆå¹´
}

export interface MonthlyC ashFlow {
  year: number;
  month: number;
  age: number;
  income: number;
  expenses: number;
  savings: number;
}

export function calculateCashFlow(input: CashFlowInput): MonthlyCashFlow[] {
  const results: MonthlyCashFlow[] = [];
  let currentSavings = input.currentSavings;
  const startYear = new Date().getFullYear();

  // ç¾åœ¨å¹´é½¢ã‹ã‚‰100æ­³ã¾ã§è¨ˆç®—
  for (let age = input.currentAge; age <= input.lifeExpectancy; age++) {
    for (let month = 1; month <= 12; month++) {
      const year = startYear + (age - input.currentAge);

      // åå…¥è¨ˆç®—
      let income = age < input.retirementAge ? input.annualIncome / 12 : 0;

      // é€€è·é‡‘
      if (age === input.retirementAge && month === 4) {
        // ä»®: å¹´åã®2.5å€
        income += input.annualIncome * 2.5;
      }

      // å¹´é‡‘ï¼ˆ65æ­³ã‹ã‚‰ï¼‰
      if (age >= 65) {
        // ä»®: å¹´åã®40%
        income += (input.annualIncome * 0.4) / 12;
      }

      // æ”¯å‡ºè¨ˆç®—
      let expenses = input.monthlyExpenses;

      // ä½å®…ãƒ­ãƒ¼ãƒ³
      if (input.loanPayment && year <= (input.loanEndYear || 9999)) {
        expenses += input.loanPayment;
      }

      // ãƒ©ã‚¤ãƒ•ã‚¤ãƒ™ãƒ³ãƒˆè²»ç”¨
      const eventsThisMonth = input.lifeEvents.filter(
        (e) => e.eventYear === year && e.eventMonth === month
      );
      for (const event of eventsThisMonth) {
        expenses += event.amount;

        // ç¶™ç¶šè²»ç”¨ã®å ´åˆã€ç¿Œå¹´ä»¥é™ã‚‚è¨ˆä¸Š
        if (event.recurring && event.recurringYears) {
          for (let i = 1; i < event.recurringYears; i++) {
            // TODO: ç¶™ç¶šè²»ç”¨ã‚’åˆ¥é€”ç®¡ç†
          }
        }
      }

      // è²¯è“„æ®‹é«˜æ›´æ–°
      currentSavings += income - expenses;

      results.push({
        year,
        month,
        age,
        income: Math.round(income),
        expenses: Math.round(expenses),
        savings: Math.round(currentSavings),
      });
    }
  }

  return results;
}

// è³‡é‡‘ã‚·ãƒ§ãƒ¼ãƒˆæ¤œå‡º
export function detectCashShortage(cashFlow: MonthlyCashFlow[]): MonthlyCashFlow[] {
  return cashFlow.filter((cf) => cf.savings < 0);
}

// è²¯è“„ãƒ”ãƒ¼ã‚¯ãƒ»ãƒœãƒˆãƒ æ¤œå‡º
export function findSavingsPeaks(cashFlow: MonthlyCashFlow[]): {
  peak: MonthlyCashFlow;
  bottom: MonthlyCashFlow;
} {
  let peak = cashFlow[0];
  let bottom = cashFlow[0];

  for (const cf of cashFlow) {
    if (cf.savings > peak.savings) peak = cf;
    if (cf.savings < bottom.savings) bottom = cf;
  }

  return { peak, bottom };
}
```

#### 2. ã‚°ãƒ©ãƒ•ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```bash
npm install recharts
```

```typescript
// src/components/CashFlow/CashFlowChart.tsx
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, ReferenceLine } from 'recharts';
import { MonthlyCashFlow } from '@/utils/cashFlowCalculator';

interface CashFlowChartProps {
  data: MonthlyCashFlow[];
}

export function CashFlowChart({ data }: CashFlowChartProps) {
  // å¹´æ¬¡ãƒ‡ãƒ¼ã‚¿ã«é›†ç´„ï¼ˆè¡¨ç¤ºã‚’ç°¡ç•¥åŒ–ï¼‰
  const yearlyData = data.filter((d, i) => i % 12 === 0);

  return (
    <div className="w-full h-96">
      <ResponsiveContainer width="100%" height="100%">
        <LineChart data={yearlyData}>
          <CartesianGrid strokeDasharray="3 3" />
          <XAxis
            dataKey="year"
            label={{ value: 'å¹´', position: 'insideBottomRight', offset: -10 }}
          />
          <YAxis
            label={{ value: 'é‡‘é¡ï¼ˆä¸‡å††ï¼‰', angle: -90, position: 'insideLeft' }}
            tickFormatter={(value) => `${(value / 10000).toLocaleString()}`}
          />
          <Tooltip
            formatter={(value: number) => `${(value / 10000).toLocaleString()}ä¸‡å††`}
            labelFormatter={(label) => `${label}å¹´`}
          />
          <Legend />
          <ReferenceLine y={0} stroke="red" strokeDasharray="3 3" />
          <Line
            type="monotone"
            dataKey="income"
            stroke="#10B981"
            name="åå…¥"
            strokeWidth={2}
          />
          <Line
            type="monotone"
            dataKey="expenses"
            stroke="#EF4444"
            name="æ”¯å‡º"
            strokeWidth={2}
          />
          <Line
            type="monotone"
            dataKey="savings"
            stroke="#3B82F6"
            name="è²¯è“„æ®‹é«˜"
            strokeWidth={3}
          />
        </LineChart>
      </ResponsiveContainer>
    </div>
  );
}
```

#### 3. CFåˆ†æã‚µãƒãƒªãƒ¼

```typescript
// src/components/CashFlow/CashFlowSummary.tsx
import { MonthlyCashFlow, detectCashShortage, findSavingsPeaks } from '@/utils/cashFlowCalculator';

interface CashFlowSummaryProps {
  data: MonthlyCashFlow[];
}

export function CashFlowSummary({ data }: CashFlowSummaryProps) {
  const shortages = detectCashShortage(data);
  const { peak, bottom } = findSavingsPeaks(data);

  return (
    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
      {/* è²¯è“„ãƒ”ãƒ¼ã‚¯ */}
      <div className="p-4 bg-blue-50 border border-blue-200 rounded-lg">
        <h3 className="text-sm font-semibold text-blue-800 mb-2">è²¯è“„ãƒ”ãƒ¼ã‚¯</h3>
        <p className="text-2xl font-bold text-blue-600">
          {(peak.savings / 10000).toLocaleString()}ä¸‡å††
        </p>
        <p className="text-xs text-gray-600 mt-1">
          {peak.year}å¹´{peak.month}æœˆï¼ˆ{peak.age}æ­³ï¼‰
        </p>
      </div>

      {/* è²¯è“„æœ€ä½ */}
      <div className={`p-4 border rounded-lg ${
        bottom.savings < 0 ? 'bg-red-50 border-red-200' : 'bg-yellow-50 border-yellow-200'
      }`}>
        <h3 className={`text-sm font-semibold mb-2 ${
          bottom.savings < 0 ? 'text-red-800' : 'text-yellow-800'
        }`}>
          è²¯è“„æœ€ä½
        </h3>
        <p className={`text-2xl font-bold ${
          bottom.savings < 0 ? 'text-red-600' : 'text-yellow-600'
        }`}>
          {(bottom.savings / 10000).toLocaleString()}ä¸‡å††
        </p>
        <p className="text-xs text-gray-600 mt-1">
          {bottom.year}å¹´{bottom.month}æœˆï¼ˆ{bottom.age}æ­³ï¼‰
        </p>
      </div>

      {/* è³‡é‡‘ã‚·ãƒ§ãƒ¼ãƒˆè­¦å‘Š */}
      <div className={`p-4 border rounded-lg ${
        shortages.length > 0 ? 'bg-red-50 border-red-200' : 'bg-green-50 border-green-200'
      }`}>
        <h3 className={`text-sm font-semibold mb-2 ${
          shortages.length > 0 ? 'text-red-800' : 'text-green-800'
        }`}>
          è³‡é‡‘ã‚·ãƒ§ãƒ¼ãƒˆ
        </h3>
        <p className={`text-2xl font-bold ${
          shortages.length > 0 ? 'text-red-600' : 'text-green-600'
        }`}>
          {shortages.length > 0 ? `${shortages.length}ãƒ¶æœˆ` : 'ãªã—'}
        </p>
        {shortages.length > 0 && (
          <p className="text-xs text-gray-600 mt-1">
            æœ€åˆ: {shortages[0].year}å¹´{shortages[0].month}æœˆ
          </p>
        )}
      </div>
    </div>
  );
}
```

### âœ… å®Œäº†æ¡ä»¶

- [ ] CFè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
- [ ] Rechartsã‚°ãƒ©ãƒ•å®Ÿè£…
- [ ] å¹´æ¬¡ãƒ»æœˆæ¬¡åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
- [ ] è³‡é‡‘ã‚·ãƒ§ãƒ¼ãƒˆè‡ªå‹•æ¤œå‡º
- [ ] ã‚µãƒãƒªãƒ¼è¡¨ç¤º
- [ ] Supabaseé€£æºï¼ˆè¨ˆç®—çµæœã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
- [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ
- [ ] ãƒ†ã‚¹ãƒˆä½œæˆ

### ğŸ”§ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- Rechartsï¼ˆã‚°ãƒ©ãƒ•ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰
- React Queryï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒï¼‰

### ğŸ“ æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«

```
src/
â”œâ”€â”€ components/
â”‚   â””â”€â”€ CashFlow/
â”‚       â”œâ”€â”€ CashFlowChart.tsx
â”‚       â”œâ”€â”€ CashFlowSummary.tsx
â”‚       â””â”€â”€ CashFlowTable.tsx
â””â”€â”€ utils/
    â””â”€â”€ cashFlowCalculator.ts
```

### âœ… ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå§”ä»»: å¯èƒ½

**ç†ç”±**: è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã¨UIè¡¨ç¤ºãŒåˆ†é›¢ã•ã‚Œã¦ãŠã‚Šã€ç‹¬ç«‹ã—ã¦å®Ÿè£…å¯èƒ½

---

## ISSUE-104: æ•™è‚²è²»è¨ˆç®— ğŸŸ¡ High

### ğŸ“‹ æ¦‚è¦

å¹¼ç¨šåœ’ã€œå¤§å­¦ã¾ã§ã®æ•™è‚²è²»ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¾ã™ã€‚å…¬ç«‹ãƒ»ç§ç«‹ãƒ»å›½ç«‹ã®é¸æŠè‚¢ã‚’æä¾›ã—ã€æ–‡éƒ¨ç§‘å­¦çœã®çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’æ´»ç”¨ã—ã¾ã™ã€‚

### ğŸ¯ ã‚¿ã‚¹ã‚¯è©³ç´°

#### 1. æ•™è‚²è²»ãƒ‡ãƒ¼ã‚¿

```typescript
// src/data/educationCosts.ts
export interface EducationCost {
  stage: 'kindergarten' | 'elementary' | 'junior_high' | 'high_school' | 'university';
  type: 'public' | 'private' | 'national';
  annualCost: number;
  years: number;
}

// æ–‡éƒ¨ç§‘å­¦çœã€Œå­ä¾›ã®å­¦ç¿’è²»èª¿æŸ»ã€ä»¤å’Œ3å¹´åº¦ãƒ‡ãƒ¼ã‚¿
export const EDUCATION_COSTS: EducationCost[] = [
  // å¹¼ç¨šåœ’ï¼ˆ3å¹´é–“ï¼‰
  { stage: 'kindergarten', type: 'public', annualCost: 223647, years: 3 },
  { stage: 'kindergarten', type: 'private', annualCost: 527916, years: 3 },

  // å°å­¦æ ¡ï¼ˆ6å¹´é–“ï¼‰
  { stage: 'elementary', type: 'public', annualCost: 352566, years: 6 },
  { stage: 'elementary', type: 'private', annualCost: 1666949, years: 6 },

  // ä¸­å­¦æ ¡ï¼ˆ3å¹´é–“ï¼‰
  { stage: 'junior_high', type: 'public', annualCost: 538799, years: 3 },
  { stage: 'junior_high', type: 'private', annualCost: 1436353, years: 3 },

  // é«˜æ ¡ï¼ˆ3å¹´é–“ï¼‰
  { stage: 'high_school', type: 'public', annualCost: 512971, years: 3 },
  { stage: 'high_school', type: 'private', annualCost: 1054444, years: 3 },

  // å¤§å­¦ï¼ˆ4å¹´é–“ï¼‰
  { stage: 'university', type: 'national', annualCost: 817800, years: 4 },
  { stage: 'university', type: 'public', annualCost: 932251, years: 4 },
  { stage: 'university', type: 'private', annualCost: 1536033, years: 4 },
];

export interface ChildEducationPlan {
  childName: string;
  birthYear: number;
  kindergarten: 'public' | 'private';
  elementary: 'public' | 'private';
  juniorHigh: 'public' | 'private';
  highSchool: 'public' | 'private';
  university: 'public' | 'private' | 'national' | 'none';
}

export function calculateEducationCost(plan: ChildEducationPlan): {
  totalCost: number;
  yearlyBreakdown: { year: number; stage: string; cost: number }[];
} {
  const breakdown: { year: number; stage: string; cost: number }[] = [];
  let totalCost = 0;

  // å¹¼ç¨šåœ’ï¼ˆ3æ­³ã€œ5æ­³ï¼‰
  const kindergartenData = EDUCATION_COSTS.find(
    (d) => d.stage === 'kindergarten' && d.type === plan.kindergarten
  )!;
  for (let i = 0; i < kindergartenData.years; i++) {
    const year = plan.birthYear + 3 + i;
    breakdown.push({ year, stage: 'å¹¼ç¨šåœ’', cost: kindergartenData.annualCost });
    totalCost += kindergartenData.annualCost;
  }

  // å°å­¦æ ¡ï¼ˆ6æ­³ã€œ11æ­³ï¼‰
  const elementaryData = EDUCATION_COSTS.find(
    (d) => d.stage === 'elementary' && d.type === plan.elementary
  )!;
  for (let i = 0; i < elementaryData.years; i++) {
    const year = plan.birthYear + 6 + i;
    breakdown.push({ year, stage: 'å°å­¦æ ¡', cost: elementaryData.annualCost });
    totalCost += elementaryData.annualCost;
  }

  // ä¸­å­¦æ ¡ï¼ˆ12æ­³ã€œ14æ­³ï¼‰
  const juniorHighData = EDUCATION_COSTS.find(
    (d) => d.stage === 'junior_high' && d.type === plan.juniorHigh
  )!;
  for (let i = 0; i < juniorHighData.years; i++) {
    const year = plan.birthYear + 12 + i;
    breakdown.push({ year, stage: 'ä¸­å­¦æ ¡', cost: juniorHighData.annualCost });
    totalCost += juniorHighData.annualCost;
  }

  // é«˜æ ¡ï¼ˆ15æ­³ã€œ17æ­³ï¼‰
  const highSchoolData = EDUCATION_COSTS.find(
    (d) => d.stage === 'high_school' && d.type === plan.highSchool
  )!;
  for (let i = 0; i < highSchoolData.years; i++) {
    const year = plan.birthYear + 15 + i;
    breakdown.push({ year, stage: 'é«˜æ ¡', cost: highSchoolData.annualCost });
    totalCost += highSchoolData.annualCost;
  }

  // å¤§å­¦ï¼ˆ18æ­³ã€œ21æ­³ï¼‰
  if (plan.university !== 'none') {
    const universityData = EDUCATION_COSTS.find(
      (d) => d.stage === 'university' && d.type === plan.university
    )!;
    for (let i = 0; i < universityData.years; i++) {
      const year = plan.birthYear + 18 + i;
      breakdown.push({ year, stage: 'å¤§å­¦', cost: universityData.annualCost });
      totalCost += universityData.annualCost;
    }
  }

  return { totalCost, yearlyBreakdown: breakdown };
}
```

#### 2. æ•™è‚²è²»è¨ˆç®—UI

```typescript
// src/components/Education/EducationPlanForm.tsx
import { useState } from 'react';
import { ChildEducationPlan, calculateEducationCost } from '@/data/educationCosts';

export function EducationPlanForm() {
  const [children, setChildren] = useState<ChildEducationPlan[]>([]);
  const [newChild, setNewChild] = useState<ChildEducationPlan>({
    childName: '',
    birthYear: new Date().getFullYear(),
    kindergarten: 'public',
    elementary: 'public',
    juniorHigh: 'public',
    highSchool: 'public',
    university: 'national',
  });

  const addChild = () => {
    if (!newChild.childName) return;
    setChildren([...children, newChild]);
    setNewChild({
      childName: '',
      birthYear: new Date().getFullYear(),
      kindergarten: 'public',
      elementary: 'public',
      juniorHigh: 'public',
      highSchool: 'public',
      university: 'national',
    });
  };

  // åˆè¨ˆæ•™è‚²è²»è¨ˆç®—
  const totalEducationCost = children.reduce((sum, child) => {
    const { totalCost } = calculateEducationCost(child);
    return sum + totalCost;
  }, 0);

  return (
    <div className="space-y-6">
      <h2 className="text-2xl font-bold">æ•™è‚²è²»ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h2>

      {/* å­ä¾›è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  */}
      <div className="p-4 border rounded-lg space-y-4">
        <h3 className="font-semibold">ãŠå­æ§˜æƒ…å ±è¿½åŠ </h3>

        <div className="grid grid-cols-2 gap-4">
          <input
            type="text"
            placeholder="ãŠå­æ§˜ã®åå‰"
            value={newChild.childName}
            onChange={(e) => setNewChild({ ...newChild, childName: e.target.value })}
            className="px-3 py-2 border rounded-lg"
          />
          <input
            type="number"
            placeholder="ç”Ÿã¾ã‚Œå¹´"
            value={newChild.birthYear}
            onChange={(e) => setNewChild({ ...newChild, birthYear: Number(e.target.value) })}
            className="px-3 py-2 border rounded-lg"
          />
        </div>

        <div className="grid grid-cols-2 md:grid-cols-5 gap-2">
          <select
            value={newChild.kindergarten}
            onChange={(e) => setNewChild({ ...newChild, kindergarten: e.target.value as 'public' | 'private' })}
            className="px-2 py-1 border rounded"
          >
            <option value="public">å¹¼ç¨šåœ’: å…¬ç«‹</option>
            <option value="private">å¹¼ç¨šåœ’: ç§ç«‹</option>
          </select>
          <select
            value={newChild.elementary}
            onChange={(e) => setNewChild({ ...newChild, elementary: e.target.value as 'public' | 'private' })}
            className="px-2 py-1 border rounded"
          >
            <option value="public">å°å­¦æ ¡: å…¬ç«‹</option>
            <option value="private">å°å­¦æ ¡: ç§ç«‹</option>
          </select>
          <select
            value={newChild.juniorHigh}
            onChange={(e) => setNewChild({ ...newChild, juniorHigh: e.target.value as 'public' | 'private' })}
            className="px-2 py-1 border rounded"
          >
            <option value="public">ä¸­å­¦æ ¡: å…¬ç«‹</option>
            <option value="private">ä¸­å­¦æ ¡: ç§ç«‹</option>
          </select>
          <select
            value={newChild.highSchool}
            onChange={(e) => setNewChild({ ...newChild, highSchool: e.target.value as 'public' | 'private' })}
            className="px-2 py-1 border rounded"
          >
            <option value="public">é«˜æ ¡: å…¬ç«‹</option>
            <option value="private">é«˜æ ¡: ç§ç«‹</option>
          </select>
          <select
            value={newChild.university}
            onChange={(e) => setNewChild({ ...newChild, university: e.target.value as any })}
            className="px-2 py-1 border rounded"
          >
            <option value="national">å¤§å­¦: å›½ç«‹</option>
            <option value="public">å¤§å­¦: å…¬ç«‹</option>
            <option value="private">å¤§å­¦: ç§ç«‹</option>
            <option value="none">å¤§å­¦: é€²å­¦ãªã—</option>
          </select>
        </div>

        <button
          onClick={addChild}
          className="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700"
        >
          è¿½åŠ 
        </button>
      </div>

      {/* å­ä¾›ä¸€è¦§ */}
      <div className="space-y-4">
        <h3 className="font-semibold">ç™»éŒ²æ¸ˆã¿ã®ãŠå­æ§˜ï¼ˆ{children.length}äººï¼‰</h3>
        {children.map((child, index) => {
          const { totalCost } = calculateEducationCost(child);
          return (
            <div key={index} className="p-4 border rounded-lg">
              <div className="flex justify-between items-start">
                <div>
                  <h4 className="font-semibold">{child.childName}</h4>
                  <p className="text-sm text-gray-600">{child.birthYear}å¹´ç”Ÿã¾ã‚Œ</p>
                  <p className="text-lg font-bold text-blue-600 mt-2">
                    åˆè¨ˆ: {(totalCost / 10000).toLocaleString()}ä¸‡å††
                  </p>
                </div>
                <button
                  onClick={() => setChildren(children.filter((_, i) => i !== index))}
                  className="text-red-500 hover:text-red-700"
                >
                  å‰Šé™¤
                </button>
              </div>
            </div>
          );
        })}
      </div>

      {/* åˆè¨ˆæ•™è‚²è²» */}
      <div className="p-6 bg-blue-50 border border-blue-200 rounded-lg">
        <h3 className="text-lg font-semibold mb-2">å…¨ä½“ã®æ•™è‚²è²»</h3>
        <p className="text-3xl font-bold text-blue-600">
          {(totalEducationCost / 10000).toLocaleString()}ä¸‡å††
        </p>
      </div>
    </div>
  );
}
```

### âœ… å®Œäº†æ¡ä»¶

- [ ] æ•™è‚²è²»ãƒ‡ãƒ¼ã‚¿ä½œæˆï¼ˆæ–‡ç§‘çœçµ±è¨ˆï¼‰
- [ ] è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
- [ ] EducationPlanFormã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…
- [ ] è¤‡æ•°å­ä¾›å¯¾å¿œ
- [ ] Supabaseé€£æº
- [ ] CFè¡¨ã¸ã®è‡ªå‹•åæ˜ 
- [ ] ãƒ†ã‚¹ãƒˆä½œæˆ

### ğŸ”§ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- React
- TypeScript
- Supabase

### ğŸ“ æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«

```
src/
â”œâ”€â”€ components/
â”‚   â””â”€â”€ Education/
â”‚       â”œâ”€â”€ EducationPlanForm.tsx
â”‚       â””â”€â”€ EducationCostChart.tsx
â””â”€â”€ data/
    â””â”€â”€ educationCosts.ts
```

### âœ… ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå§”ä»»: å¯èƒ½

---

## ISSUE-105: è€å¾Œè³‡é‡‘ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ğŸŸ¡ High

*(è©³ç´°ã¯çœç•¥ - ISSUE-104ã¨åŒæ§˜ã®æ§‹é€ )*

### âœ… å®Œäº†æ¡ä»¶

- [ ] å¹´é‡‘æ¨å®šãƒ­ã‚¸ãƒƒã‚¯
- [ ] è€å¾Œç”Ÿæ´»è²»è¨ˆç®—
- [ ] åŒ»ç™‚ãƒ»ä»‹è­·è²»ç”¨æ¨å®š
- [ ] é•·ç”Ÿããƒªã‚¹ã‚¯åˆ†æï¼ˆ90/95/100æ­³ï¼‰

### âœ… ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå§”ä»»: å¯èƒ½

---

## ISSUE-106: PDFãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ ğŸŸ¢ Medium

### ğŸ“‹ æ¦‚è¦

ãƒ©ã‚¤ãƒ•ãƒ—ãƒ©ãƒ³å…¨ä½“ã‚’PDFãƒ¬ãƒãƒ¼ãƒˆã¨ã—ã¦å‡ºåŠ›ã—ã¾ã™ã€‚

### ğŸ¯ ã‚¿ã‚¹ã‚¯è©³ç´°

```bash
npm install jspdf html2canvas
```

```typescript
// src/utils/pdfGenerator.ts
import jsPDF from 'jspdf';
import html2canvas from 'html2canvas';

export async function generateLifePlanPDF(lifePlanId: string): Promise<Blob> {
  // å®Ÿè£…è©³ç´°
}
```

### âœ… å®Œäº†æ¡ä»¶

- [ ] jsPDFçµ±åˆ
- [ ] html2canvasçµ±åˆ
- [ ] ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆ
- [ ] FPäº‹å‹™æ‰€ãƒ­ã‚´æŒ¿å…¥æ©Ÿèƒ½
- [ ] ã‚«ãƒ©ãƒ¼ãƒ†ãƒ¼ãƒã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### âœ… ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå§”ä»»: å¯èƒ½

---

## ISSUE-107: Stripeæ±ºæ¸ˆçµ±åˆ ğŸŸ¡ High

### ğŸ“‹ æ¦‚è¦

æœˆé¡Â¥980ã®ãƒ©ã‚¤ãƒˆæœ‰æ–™ç‰ˆã¸ã®èª²é‡‘æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

### ğŸ¯ ã‚¿ã‚¹ã‚¯è©³ç´°

```bash
npm install @stripe/stripe-js
```

```typescript
// src/lib/stripe.ts
import { loadStripe } from '@stripe/stripe-js';

export const stripePromise = loadStripe(import.meta.env.VITE_STRIPE_PUBLIC_KEY || '');
```

### âœ… å®Œäº†æ¡ä»¶

- [ ] Stripeã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ
- [ ] ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³è¨­å®š
- [ ] ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆå®Ÿè£…
- [ ] Webhookå®Ÿè£…ï¼ˆSupabase Functionsï¼‰
- [ ] ãƒ—ãƒ©ãƒ³å¤‰æ›´æ©Ÿèƒ½
- [ ] ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ©Ÿèƒ½

### ğŸš« ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå§”ä»»: ä¸å¯

**ç†ç”±**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»æ±ºæ¸ˆå‡¦ç†ã®ç†è§£ãŒå¿…è¦

---

## ğŸ“ Phase 1å®Œäº†å¾Œã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] å…¨7 Issueã‚¯ãƒ­ãƒ¼ã‚º
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿæ–½
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼å—ã‘å…¥ã‚Œãƒ†ã‚¹ãƒˆï¼ˆUATï¼‰
- [ ] æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°
- [ ] åˆæœŸãƒ¦ãƒ¼ã‚¶ãƒ¼50åç²å¾—
- [ ] MRR Â¥49,000é”æˆ

---

**Next Phase**: [PHASE2_TIER2_ISSUES.md](./PHASE2_TIER2_ISSUES.md)
