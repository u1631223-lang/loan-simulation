# TICKET-990: お客様名登録機能 - テストチェックリスト

**テスト実施日**: 2025-10-27
**テスター**: _________________
**環境**: [ ] Development [ ] Staging [ ] Production

---

## 📋 テスト前提条件

### 準備

- [ ] Supabase 移行スクリプトが適用済み
  ```bash
  npx supabase db push
  ```
- [ ] アプリケーションがビルド・デプロイ済み
- [ ] 3つのテストアカウントを用意
  - [ ] Tier 1: 匿名ユーザー（ログインなし）
  - [ ] Tier 2: 登録ユーザー（メール登録）
  - [ ] Tier 3: プレミアムユーザー（サブスク契約）

---

## 🧪 Tier 1（匿名ユーザー）テスト

### 借入額から計算（Forward Mode）

- [ ] お客様名フィールドが**表示されない**ことを確認
- [ ] 借入金額: 5000万円
- [ ] 金利: 1.0%
- [ ] 返済期間: 40年
- [ ] 返済方式: 元利均等
- [ ] 「計算する」ボタンをクリック
- [ ] 計算結果が正常に表示される
- [ ] 履歴に保存される（顧客名なし）

### 返済額から計算（Reverse Mode）

- [ ] お客様名フィールドが**表示されない**ことを確認
- [ ] 月々の返済額: 150,000円
- [ ] 金利: 1.0%
- [ ] 返済期間: 40年
- [ ] 「計算する」ボタンをクリック
- [ ] 計算結果が正常に表示される
- [ ] 履歴に保存される（顧客名なし）

### 履歴確認

- [ ] 履歴一覧を開く
- [ ] 保存された履歴に**顧客名が表示されない**ことを確認
- [ ] 履歴をクリックして詳細表示が正常に動作する

**Tier 1 テスト結果**: [ ] PASS [ ] FAIL

---

## 🧪 Tier 2（登録ユーザー）テスト

### ログイン

- [ ] メールアドレスとパスワードでログイン
- [ ] ダッシュボードに遷移
- [ ] ヘッダーにユーザー名が表示される

### 借入額から計算（Forward Mode）

- [ ] お客様名フィールドが**表示される**ことを確認
- [ ] フィールドのスタイルが既存入力と同じ
- [ ] プレースホルダー: "例）山田 太郎"
- [ ] アイコン: 👤 が表示される
- [ ] ラベル: "お客様名（任意）"

#### テストケース1: 顧客名あり

- [ ] お客様名: 「山田 太郎」と入力
- [ ] 借入金額: 5000万円
- [ ] 金利: 1.0%
- [ ] 返済期間: 40年
- [ ] 返済方式: 元利均等
- [ ] 「計算する」ボタンをクリック
- [ ] 計算結果が正常に表示される
- [ ] 履歴に保存される
- [ ] 履歴一覧で「山田 太郎」が表示される
- [ ] 顧客名の表示スタイル:
  - [ ] 背景色: bg-blue-50
  - [ ] ボーダー: border-blue-100
  - [ ] アイコン: 👤
  - [ ] フォント: font-medium

#### テストケース2: 顧客名なし（空欄）

- [ ] お客様名: 空欄のまま
- [ ] 借入金額: 3000万円
- [ ] 金利: 1.5%
- [ ] 返済期間: 35年
- [ ] 返済方式: 元金均等
- [ ] 「計算する」ボタンをクリック
- [ ] 計算結果が正常に表示される
- [ ] 履歴に保存される
- [ ] 履歴一覧で顧客名が**表示されない**ことを確認

### 返済額から計算（Reverse Mode）

- [ ] 「返済額から計算」タブに切り替え
- [ ] お客様名フィールドが**表示される**ことを確認

#### テストケース3: 逆算モードで顧客名あり

- [ ] お客様名: 「佐藤 花子」と入力
- [ ] 月々の返済額: 150,000円
- [ ] 金利: 1.0%
- [ ] 返済期間: 40年
- [ ] 「計算する」ボタンをクリック
- [ ] 計算結果が正常に表示される
- [ ] 履歴に保存される
- [ ] 履歴一覧で「佐藤 花子」が表示される

### クラウド同期確認

- [ ] Supabase Dashboard → Table Editor → loan_history
- [ ] 最新の履歴レコードを確認
- [ ] `customer_name` カラムに「山田 太郎」が保存されている
- [ ] `params` JSONB に `customerName: "山田 太郎"` が含まれている

### ログアウト→再ログイン

- [ ] ログアウト
- [ ] 再度ログイン
- [ ] 履歴一覧を開く
- [ ] クラウドから同期された履歴に顧客名が表示される

**Tier 2 テスト結果**: [ ] PASS [ ] FAIL

---

## 🧪 Tier 3（プレミアムユーザー）テスト

### プレミアムアカウント確認

- [ ] ログイン
- [ ] ダッシュボードでプレミアムバッジが表示される
- [ ] Supabase Database で `user_metadata.is_premium = true` を確認

### 機能確認

- [ ] お客様名フィールドが**表示される**ことを確認
- [ ] Tier 2 と同じ動作をする

#### テストケース4: プレミアムユーザーの顧客名登録

- [ ] お客様名: 「田中 一郎」と入力
- [ ] 借入金額: 8000万円
- [ ] 金利: 0.8%
- [ ] 返済期間: 35年
- [ ] 「計算する」ボタンをクリック
- [ ] 計算結果が正常に表示される
- [ ] 履歴に保存される
- [ ] 履歴一覧で「田中 一郎」が表示される

**Tier 3 テスト結果**: [ ] PASS [ ] FAIL

---

## 🎨 デザインチェック

### フィールドスタイル

- [ ] 既存フィールドと同じボーダー: `border-2 border-gray-300`
- [ ] 同じパディング: `px-4 py-2`
- [ ] 同じフォーカススタイル: `focus:ring-2 focus:ring-primary/50`
- [ ] 同じ角丸: `rounded-lg`
- [ ] ラベルスタイル: `text-sm font-medium text-gray-700 mb-1`

### 履歴表示スタイル

- [ ] 背景色: `bg-blue-50`
- [ ] ボーダー: `border border-blue-100`
- [ ] パディング: `px-3 py-2`
- [ ] 角丸: `rounded-lg`
- [ ] アイコンサイズ: `text-base`
- [ ] テキストスタイル: `font-medium text-gray-800`

### レスポンシブデザイン

#### デスクトップ（1920x1080）

- [ ] フィールドが正常に表示される
- [ ] 履歴カードが正常に表示される
- [ ] レイアウトが崩れていない

#### タブレット（768x1024）

- [ ] フィールドが正常に表示される
- [ ] 履歴カードが正常に表示される
- [ ] レイアウトが崩れていない

#### スマートフォン（375x667）

- [ ] フィールドが正常に表示される
- [ ] 履歴カードが正常に表示される
- [ ] レイアウトが崩れていない
- [ ] キーボード表示時にフィールドが隠れない

**デザインチェック結果**: [ ] PASS [ ] FAIL

---

## 🔍 エッジケースチェック

### 入力バリデーション

- [ ] 最大文字数（50文字）を超える入力を試す → 50文字で切られる
- [ ] 特殊文字を含む名前（例：「山田 太郎（営業）」）→ 正常に保存される
- [ ] 絵文字を含む名前（例：「山田 太郎😀」）→ 正常に保存される

### 履歴上限確認

- [ ] 21件以上の履歴を作成（一部に顧客名あり、一部になし）
- [ ] 最新20件のみ保存される
- [ ] 顧客名が正しく表示される

### Tier 変更時の動作

- [ ] Tier 2 で顧客名入力して計算
- [ ] ログアウト（Tier 1 になる）
- [ ] 履歴を確認 → 顧客名が**表示されない**
- [ ] 再ログイン（Tier 2 に戻る）
- [ ] 履歴を確認 → 顧客名が**表示される**

**エッジケースチェック結果**: [ ] PASS [ ] FAIL

---

## 🐛 バグレポート

### Bug #1

- **説明**: _________________
- **再現手順**: _________________
- **期待される動作**: _________________
- **実際の動作**: _________________
- **スクリーンショット**: _________________

### Bug #2

- **説明**: _________________
- **再現手順**: _________________
- **期待される動作**: _________________
- **実際の動作**: _________________
- **スクリーンショット**: _________________

---

## ✅ 総合評価

| テスト項目 | 結果 | 備考 |
|-----------|------|------|
| Tier 1 テスト | [ ] PASS [ ] FAIL |  |
| Tier 2 テスト | [ ] PASS [ ] FAIL |  |
| Tier 3 テスト | [ ] PASS [ ] FAIL |  |
| デザインチェック | [ ] PASS [ ] FAIL |  |
| エッジケースチェック | [ ] PASS [ ] FAIL |  |

**総合結果**: [ ] PASS [ ] FAIL

**テスト完了日時**: _________________
**テスター署名**: _________________

---

## 📸 スクリーンショット（オプション）

### Tier 1（匿名）

- [ ] フォーム画面（顧客名フィールドなし）
- [ ] 履歴一覧（顧客名なし）

### Tier 2（登録）

- [ ] フォーム画面（顧客名フィールドあり）
- [ ] 顧客名入力後のフォーム
- [ ] 履歴一覧（顧客名表示）
- [ ] Supabase Database（customer_name カラム）

### モバイル

- [ ] iPhone（顧客名フィールド）
- [ ] Android（顧客名フィールド）

---

**注意事項**:
- すべてのテストケースは本番環境に近い環境で実施すること
- スクリーンショットを撮影して記録すること
- バグが発見された場合は、GitHub Issues に登録すること
